## Set the page title
#set( $page_title = "Crawler Controlpage" )

## some headers
#set( $h1 = "<script src='/js/prototype.js' type='text/javascript'></script>")
#set( $h2 = "<script src='/js/scriptaculous.js' type='text/javascript'></script>")
#set( $page_headers = [$h1,$h2] )

## the content

## Activate onload
#set ( $bodyonload = "initTabs('singlecrawl');" )

<ul class="tabs">
	<li><a href="#dsinglecrawl" onclick="fshow('singlecrawl');" id="tsinglecrawl">Crawl URL</a></li>
	<li><a href="#dmasscrawl" onclick="fshow('masscrawl');" id="tmasscrawl">Mass Crawl</a></li>
	<li><a href="#dquickcrawl" onclick="fshow('quickcrawl');" id="tquickcrawl">Crawler Bookmarklet</a></li>
</ul>

#if( $errorUrls && $errorUrls.size() > 0)
<p class="error">
	The following URLs could not be crawled because of following errors:		
	<ul>
	#foreach ( $entry in $errorUrls.entrySet())
		<li><a href="$entry.getKey()">$entry.getKey()</a>: $entry.getValue()</li>
	#end
	</ul>
</p>
#end

<form action="/crawler" method="post">
#if(${manager.getService("org.paxle.core.queue.ICommandProfileManager")})
<fieldset>
	<legend>Profile</legend>
	<table>
	<tr>
		<th>Name</th>
		<th>Value</th>
		<th>Description</th>
	</tr>
	
	<tr>
		<td>Profile Name:</td>
		<td><input type="text" id="crawlDepth" name="profileName" value="$!defaultName"/></td>
		<td>&nbsp;</td>
	</tr>
	
	<tr>
		<td>Crawl Depth:</td>
		<td><input type="text" id="crawlDepth" name="crawlDepth" value="$!defaultDepth"/></td>
		<td>&nbsp;</td>
	</tr>
	
	<!-- restrict URIs -->
	#set($toggleSpecificLinks = "Effect.toggle('specificLinks', 'appear', { delay: 0, duration: 0 });")
	<tr>
		<td>Filter URLs</td>
		<td>
			<input id="crawlAllLinks" type="radio" checked="checked" value="all" name="linkMode" onclick="$toggleSpecificLinks"/>
			<label for="crawlAllLinks">All links</label>
			<br/>
			<input id="crawlSpecificLinks" type="radio" value="specific" name="linkMode" onclick="$toggleSpecificLinks"/>
			<label for="crawlSpecificLinks">Restrict to  specific link(s)</label>
			
			<div id="specificLinks">
				<input id="useRegexpFilter" type="radio" value="regexp" name="linkFilterMode" checked="checked"/>
				<label for="useRegexpFilter">Use reg.exp Filter: </label>
				<input type="text" id="links.regexpFilter" name="linkFilterExpressionRegexp" value=".*"/>
			</div>
		</td>
		<td>&nbsp;</td>
	</tr>
    <script type="text/javascript" language="javascript">
      // <![CDATA[
	  	$toggleSpecificLinks
      // ]]>
    </script>		
	
	<!-- restrict protocols -->
	#set($toggleSpecificProtocols = "Effect.toggle('specificProtocols', 'appear', { delay: 0, duration: 0 });")
	<tr>
		<td>Protocols:</td>
		<td>				
			<input id="crawlAllProtocols" type="radio" checked="checked" value="all" name="protocolMode" onclick="$toggleSpecificProtocols"/>
			<label for="crawlAllProtocols">All supported protocols</label>
			<br/>
			<input id="crawlSpecificProtocols" type="radio" value="specific" name="protocolMode" onclick="$toggleSpecificProtocols"/>
			<label for="crawlSpecificProtocols">
				Restrict to  specific protocol(s)
				<br/><font color="red">Not functional yet!</font>
			</label>
			
			<div id="specificProtocols">
    			#set($subCrawlerManager = $manager.getService( "org.paxle.crawler.ISubCrawlerManager"))
    			#set($protocols = $subCrawlerManager.getProtocols())
    			<select name="protocols" size="5" multiple="multiple">
    				#foreach($protocol in $protocols)
    					<option selected="selected">$protocol</option>
    				#end
    			</select>			
			</div>
		</td>
		<td>Restrict crawling to a given set of protocols</td>
	</tr>
    <script type="text/javascript" language="javascript">
      // <![CDATA[
	  	$toggleSpecificProtocols
      // ]]>
    </script>		
	
	<!-- restrict mime-types -->
	#set($toggleSpecificMimeTypes = "Effect.toggle('specificMimeTypes', 'appear', { delay: 0, duration: 0 });")
	<tr>
		<td>Mime-Types:</td>	
		
		<td>	
			<input id="crawlAllMimetypes" type="radio" checked="checked" value="all" name="mimetypeMode"  onclick="$toggleSpecificMimeTypes"/>
			<label for="crawlAllMimetypes">All supported mime-types</label>
			<br/>
			<input id="crawlSpecificMimetypes" type="radio" value="specific" name="mimetypeMode"  onclick="$toggleSpecificMimeTypes"/>
			<label for="crawlSpecificMimetypes">
				Restrict to specific mime-type(s).
				<br/><font color="red">Not functional yet!</font>
			</label>
			
			<div id="specificMimeTypes">
    			#set( $subParserManager = $manager.getService( "org.paxle.parser.ISubParserManager"))
    			#set( $mimeTypes = $subParserManager.getMimeTypes())
    			<select name="mimetypes" size="5" multiple="multiple">
    				#foreach($mimeType in $mimeTypes)
    					<option selected="selected">$mimeType</option>
    				#end
    			</select>
			</div>
		</td>
		<td>Restrict crawling to a given set of mime-types</td>
	</tr>
    <script type="text/javascript" language="javascript">
      // <![CDATA[
	  	$toggleSpecificMimeTypes
      // ]]>
    </script>	
		
	</table>
</fieldset>
#else
	<p class="error notInstalled">No command-profile-manager found!</p>	
#end	

<fieldset id="dsinglecrawl">
	<legend>Crawl URL</legend>	
		<p>
			<input type="text" id="startURL" name="startURL" value="http://" />
			<input type="submit" name="crawlSingle" value="Start Crawl" />
		</p>
</fieldset>

<fieldset id="dmasscrawl">
	<legend>MassCrawl URL</legend>
		<p>
			<textarea cols="80" rows="15" name="startURL2"></textarea>
			<input type="submit" name="crawlMass" value="Start Crawl" />
		</p>
</fieldset>
</form>

<fieldset id="dquickcrawl">
	<legend>Crawler Bookmarklet</legend>
	
	<div>
		Simply drag and drop the link below into the bookmark-toolbar of your browser.<br/>
		While browsing you can click on this bookmark to crawl the website that is currently viewed in your browser.
	</div>
	#set($rootPath = "${request.getScheme()}://${request.getServerName()}:${request.getServerPort()}${request.getServletPath()}")
	<a class="quickCrawl" href="javascript:w = window.open('$rootPath?crawlQuick=&amp;profileName='+escape(document.title)+'&amp;startURL='+escape(location.href),'_blank','height=600,width=800,resizable=yes,scrollbar=no,directory=no,menubar=no,location=no');w.focus();">
		Paxle-QuickCrawl
	</a>
</fieldset>
