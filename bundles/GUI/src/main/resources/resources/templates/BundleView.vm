## Set the page title
#set( $page_title = "Bundle Controlpage" )

## the regular content
#if( $bundle)
## Activate onload
#set ( $bodyonload = "initTabs('runtimeinformation');" )
<h2>Bundle Info</h2>

<ul class="tabs">
  <li><a href="#druntimeinformation" onclick="fshow('runtimeinformation');" id="truntimeinformation">Runtime Information</a></li>
  <li><a href="#dbundlemanifest" onclick="fshow('bundlemanifest');" id="tbundlemanifest">Bundle Manifest</a></li>
  <li><a href="#dexportedservices" onclick="fshow('exportedservices');" id="texportedservices">Exported Services</a></li>
  <li><a href="#dimportedservices" onclick="fshow('importedservices');" id="timportedservices">Imported Services</a></li>
</ul>

<br />
<br />

<fieldset id="druntimeinformation">
  <legend>Runtime Information</legend>
  <table>
    <tr><th>Name</th><th>Value</th></tr>
    <tr><td><b>ID</b></td><td>$bundle.BundleId</td></tr>
    <tr><td><b>Location</b></td><td>$bundle.Location</td></tr>
    <tr><td><b>State</b></td><td>$states.get($bundle.state)</td></tr>
    <tr><td><b>Last Modified</b></td><td>$dateTool.format('medium',$bundle.LastModified)</td></tr>
  </table>
</fieldset>

<fieldset id="dbundlemanifest">
  <legend>Bundle Manifest</legend>
  <table>
    <tr><th>Name</th><th>Value</th></tr>
    #set($headers = $bundle.getHeaders())	
    #foreach($name in $headers.keys())		
    <tr>
      <td valign="top"><b>$name</b></td>
      <td>
      #if($name == "Import-Package" || $name == "Export-Package" || $name == "Private-Package" || $name == "Ignore-Package" || $name == "Bundle-ClassPath" || $name == "Embed-Dependency")			
      #foreach($package in $headers.get($name).split(","))
        $package<br />
      #end
      #else
      #set($value = $headers.get($name))
      #if($value.startsWith("http:") || $value.startsWith("https:"))
        <a href="$value">$value</a>
      #else
          $value
      #end				
      #end
      </td>
    </tr>
    #end
  </table>
</fieldset>

<fieldset id="dexportedservices">
  <legend>Exported Services</legend>
  <table>
	#set($services = $bundle.getRegisteredServices())
    <tr>
      <th>Servicd ID</th>
      <th>Object Classes</th>
      <th>Properties</th>
    </tr>
    #foreach($service in $services)
    <tr>
      <td>$service.getProperty("service.id")</td>
      <td>
        #foreach($serviceClass in $service.getProperty("objectClass"))
        $serviceClass<br />
        #end
      </td>
      <td valign="top">
        <ul>
          #foreach($propName in $service.getPropertyKeys())
          #if($propName != "service.id" && $propName != "objectClass")
          <li>$propName=$service.getProperty($propName)</li>
          #end
          #end
        </ul>
       </td>
    </tr>
    #end	
  </table>
</fieldset>

<fieldset id="dimportedservices">
  <legend>Imported Services</legend>
  <table>
    #set($services = $bundle.getServicesInUse())
    <tr>
		<th>Bundle ID</th>
		<th>Service ID</th>
		<th>Object Classes</th>
		<th>Properties</th>
	</tr>	
	#foreach($service in $services)
    <tr>
      <td><a href="?bundleID=$service.Bundle.BundleId&details=">$service.Bundle.BundleId</a></td>
      <td>$service.getProperty("service.id")</td>
      <td valign="top">
      #foreach($serviceClass in $service.getProperty("objectClass"))
        $serviceClass<br />
      #end
      </td>
      <td valign="top">
        #foreach($propName in $service.getPropertyKeys())
        #if($propName != "service.id" && $propName != "objectClass")
        $propName=$service.getProperty($propName)<br />
        #end
        #end
      </td>			
    </tr>
  #end	
  </table>
</fieldset>

#else
<h2>Bundle Controlpage</h2>

#if( $errorMsg)
<p class="box error">$errorMsg</p>
#end

<h3>Install new Bundles</h3>

<h4>Install new Bundle from URL</h4><br/>
<form>
  <input type="text" name="bundlePath" size="60" />
  <input type="submit" name="installURL" value="Install" />
</form>

<h4>Instal new Bundle via File-Upload</h4>
<form enctype="multipart/form-data" method="post">
  <input type="file" name="bundleJar" size="60" />
  <input type="submit" name="installUpload" value="Install" />
</form>


<h3>Bundle List</h3>

<ul id="bundle">
  #if($bundles)
  #foreach($entry in $bundles.entrySet())
  <li>
    <form>
      <input type="hidden" name="bundleID" value="$entry.key" />
      <input type="submit" name="start" value="Start" />
      <input type="submit" name="stop" value="Stop" />
      <input type="submit" name="restart" value="Restart" />
      <input type="submit" name="update" value="Update" />
      <input type="submit" name="uninstall" value="Uninstall" />
      <a class="$states.get( $entry.value.state)" href="?bundleID=$entry.key&details=">$entry.key - $entry.value.symbolicName</a>
    </form>
  </li>
  #end
  #end
</ul>
#end
