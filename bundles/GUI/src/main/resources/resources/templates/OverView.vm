## Page title
#set($page_title = "Paxle Peer Status")

## Content

<fieldset class="infobox">
	<legend class="ovSystem">System</legend>
	<dl>
		<dt>CPUs</dt><dd>$runtime.availableProcessors()</dd>
		<dt>OS</dt><dd>$sysprops.get("os.arch")<br /> $sysprops.get("os.name")<br /> $sysprops.get("os.version")</dd>
		<dt>JVM</dt><dd>$sysprops.get("java.vendor")<br /> $sysprops.get("java.runtime.name")<br /> $sysprops.get("java.version")</dd>
		<dt>OSGi v$osgiVersion</dt><dd>by $frameworkVendor,<br /> version $frameworkVersion</dd>
	</dl>
</fieldset>

<fieldset class="infobox">
	<legend class="ovMemory">Memory</legend>
	#set($used = ($runtime.totalMemory() - $runtime.freeMemory()) / (1024 * 1024))
	#set($free = ($runtime.maxMemory() - $runtime.totalMemory() + $runtime.freeMemory()) / (1024 * 1024))
	#set($total = $runtime.maxMemory() / (1024 * 1024))
	<dl>
		<dt>Memory used:</dt><dd>$used MiB</dd>
		<dt>Memory free:</dt>
		<dd>
			$free MiB
			<form method="get" action="">
				<input class="btnGC" type="submit" name="gc" value="GC" />
			</form>
		</dd>
		<dt>Memory total:</dt><dd>$total MiB</dd>
	</dl>
</fieldset>

<fieldset class="infobox">
	<legend class="ovHost">Host</legend>
	<dl>
		<dt>Hostname:</dt><dd>$hostname</dd>
		<dt>IP:</dt><dd>$ip:$port</dd>
	</dl>
</fieldset>

#if($indexSearcher)
<fieldset class="infobox">
	<legend>Index</legend>
	<dl>
		<dt>Documents known:</dt><dd>$indexSearcher.getDocCount()</dd>
	</dl>
</fieldset>
#end
	
#if ($services.size() > 0)
<fieldset class="infobox">
	<legend class="ovActivity">Activity</legend>
		<table>
			<tr>
				<th>#</th>
				<th>Status</th>
				<th>Component</th>
				<th>PPM</th>
				<th>Active</th>
				<th>Enqueued</th>
			</tr>
			#foreach($entry in $services)
				#if ($entry.getCount() == 1)
					#set($name = $entry.getName())
				#else
					#set($name = $entry.getName() + "s")
				#end
				<tr>
					<td>$entry.getCount()</td>	
					<td>
					#if($entry.service.isPaused() == true)
						<form method="get" action="">
							<div>
								<input type="hidden" name="service" value="$entry.getName()" />
								<input class="btnResume" type="submit" name="resume" value="Resume" />
							</div>
						</form>
					#else 
						<form method="get" action="">
							<div>
								<input type="hidden" name="service" value="$entry.getName()" />
								<input class="btnPause" type="submit" name="pause" value="Pause" />
							</div>
						</form>
					#end
					</td>
					<td>
					#if ($queueServletExists == true)
						<a href="/queue?queue=$entry.getId()">$name</a>
					#else
						$name
					#end
					</td>
					<td>$entry.getService().getPPM()</td>
					<td>$entry.getService().getActiveJobCount()</td>
					<td>$entry.getService().getEnqueuedJobCount()</td>
				</tr>
			#end
		</table>
</fieldset>
#end
<p class="clearer">&nbsp;</p>
