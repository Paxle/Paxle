## Set the page title
#set( $page_title = "Paxle Status Page" )
## Activate onload
#set ( $bodyonload = "initTabs('general');" )

## ---------------------------------------------------------------------------------------
## Define some macros 
#macro( filterlist $queues)
	#if($queues)
	   #foreach($queue in $queues)
		$queue.getFilters().size() filter(s) found:<br />
		<ul>
			#foreach($filter in $queue.getFilters())
				<li><tt>$filter.getFilter().getClass().getName()</tt></li>
			#end
		</ul>
	   #end
	#end
#end
## ---------------------------------------------------------------------------------------

<ul class="tabs">
	<li><a href="#dgeneral" onclick="fshow('general');" id="tgeneral">General</a></li>
	<li><a href="#dcrawler" onclick="fshow('crawler');" id="tcrawler">Crawler</a></li>
	<li><a href="#dparser" onclick="fshow('parser');" id="tparser">Parser</a></li>
	<li><a href="#dindex" onclick="fshow('index');" id="tindex">Index</a></li>
	<li><a href="#dsearch" onclick="fshow('search');" id="tsearch">Search</a></li>
</ul>

## the regular content
<form method="post">
<fieldset id="dgeneral">
<legend>General</legend>
	<input type="submit" name="shutdown" value="Shutdown" />
	<input type="submit" name="restart" value="Restart" />
</fieldset>
</form>

#set($subCrawlerManager = $manager.getService("org.paxle.crawler.ISubCrawlerManager"))
#if($subCrawlerManager)
<fieldset id="dcrawler">
	<legend>Crawler:</legend>
	#set($crawlers = $manager.getServices("org.paxle.core.IMWComponent","(component.ID=org.paxle.crawler)"))
	#if ($crawlers)
		#foreach($crawler in $crawlers)
			#if($doPause && $doPause == true)
				$crawler.pause()
			#elseif($doResume && $doResume == true)
				$crawler.resume()	
			#elseif($doProcessNextCrawl && $doProcessNextCrawl == true)				
				$crawler.processNext()
			#end
			The crawler is 
			#if($crawler.isPaused() == true)
				<b><font color="red">paused</font></b><br/>
				<form method="get">
					<input type="submit" name="resumeCrawl" value="Resume" />
					<input type="submit" name="processNextCrawl" value="Process Next" />
				</form>
			#else 
				<b><font color="green">running</font></b><br/>
				<form method="get">
					<input type="submit" name="pauseCrawl" value="Pause" />
				</form>
			#end
			<p />
			
			Current PPM: $crawler.getPPM()
		#end
	#end


	<hr />		
	<h3>Supported protocols:</h3>
	$subCrawlerManager.getSubCrawlers().size() crawler(s) found, supporting following Protocols:<br />
	<ul>
		
		#foreach($subCrawler in $subCrawlerManager.getSubCrawlers())
				<li><tt>$subCrawler.getProtocol()</tt></li>
		#end
	</ul>
	
	<hr />
	<h3>Deployed crawler input-queue filters:</h3>
	#filterlist($manager.getServices("org.paxle.core.filter.IFilterQueue","(org.paxle.core.filter.IFilterQueue.id=org.paxle.crawler.in)"))

	<hr />
	<h3>Deployed crawler output-queue filters:</h3>
	#filterlist($manager.getServices("org.paxle.core.filter.IFilterQueue","(org.paxle.core.filter.IFilterQueue.id=org.paxle.crawler.out)"))
</fieldset>
#else
<fieldset id="dcrawler">
	<legend>Crawler:</legend>	
	<font color="red">Crawler bundle not installed!</font>
</fieldset>	
#end

#set($subParserManager = $manager.getService("org.paxle.parser.ISubParserManager"))
#if($subParserManager)
<fieldset id="dparser">
	<legend>Parser:</legend>
	#set($parsers = $manager.getServices("org.paxle.core.IMWComponent","(component.ID=org.paxle.crawler)"))	
	#if ($parsers)
		#foreach($parser in $parsers)
			The parser is 
			#if($parser.isPaused() == true)
				<b><font color="red">paused</font></b>
			#else 
				<b><font color="green">running</font></b>
			#end.
		#end
	#end

	<hr />
	<h3>Supported mimetypes:</h3>	
	#set($mimeTypes = $subParserManager.getMimeTypes())
	#set($parsers = $subParserManager.getSubParsers())		
	<b>$parsers.size()</b> parser(s) installed supporting <b>$mimeTypes.size()</b> mime-types.
	<ul>
		#foreach($mimeType in $mimeTypes)
		<li><tt>$mimeType</tt></li>
		#end
	</ul>
	
	<hr />
	<h3>Deployed parser input-queue filters:</h3>
	#filterlist($manager.getServices("org.paxle.core.filter.IFilterQueue","(org.paxle.core.filter.IFilterQueue.id=org.paxle.parser.in)"))
	
	<hr />
	<h3>Deployed parser output-queue filters:</h3>
	#filterlist($manager.getServices("org.paxle.core.filter.IFilterQueue","(org.paxle.core.filter.IFilterQueue.id=org.paxle.parser.out)"))	
</fieldset>
#else
<fieldset id="dparser">
	<legend>Parser:</legend>
	<font color="red">Parser bundle not installed!</font>
</fieldset>	
#end	

#set($se = $manager.getService("org.paxle.se.index.IIndexSearcher"))
#if($se)
<fieldset id="dindex">
	<legend>Index</legend>
	<p>Known documents: $se.docCount</p>
		
	<hr />
	<h3>Deployed indexer input-queue filters:</h3>
	#filterlist($manager.getServices("org.paxle.core.filter.IFilterQueue","(org.paxle.core.filter.IFilterQueue.id=org.paxle.indexer.in)"))	
	
	<hr />
	<h3>Deployed indexer output-queue filters:</h3>
	#filterlist($manager.getServices("org.paxle.core.filter.IFilterQueue","(org.paxle.core.filter.IFilterQueue.id=org.paxle.indexer.out)"))		
</fieldset>
#else
<fieldset id="dindex">
	<legend>Index</legend>
	<font color="red">Indexer bundle not installed!</font>	
</fieldset>	
#end

#set($sp = $manager.getService("org.paxle.se.search.ISearchProviderManager"))
#if($sp)
<fieldset id="dsearch">
	<legend>Search</legend>
		
	<h3>Installed Search Providers:</h3>
	$sp.getSearchProviders().size() provider(s) found:<br />
	<ul>		
		#foreach($searchprovider in $sp.getSearchProviders())
			<li><tt>$searchprovider.getClass().getName()</tt></li>
		#end
	</ul>		
</fieldset>
#else
<fieldset id="dsearch">
	<legend>Search</legend>
	<font color="red">Search-Engine bundle not installed!</font>	
</fieldset>	
#end
