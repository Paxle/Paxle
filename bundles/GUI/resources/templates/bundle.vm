## Set the page title
#set( $page_title = "Bundle Controlpage" )

## the regular content
#if($bundle)
<h1>Bundle Info</h1>
<fieldset>
<legend>Runtime Information</legend>
<table>
	<tr><td><b>ID</b></td><td>$bundle.BundleId</td></tr>
	<tr><td><b>Location</b></td><td>$bundle.Location</td></tr>
	<tr><td><b>State</b></td><td>$states.get($bundle.state)</td></tr>
	<tr><td><b>Last Modified</b></td><td>$bundle.LastModified</td></tr>
</table>
</fieldset>
<fieldset>
<legend>Bundle Manifest</legend>
<table>
	#set($headers = $bundle.getHeaders())	
	#foreach($name in $headers.keys())		
		<tr>
			<td valign="top"><b>$name</b></td>
			<td>
			#if($name == "Import-Package" || $name == "Export-Package")			
				#foreach($package in $headers.get($name).split(","))
					$package<br />
				#end
			#else
				#set($value = $headers.get($name))
				#if($value.startsWith("http:") || $value.startsWith("https:"))
					<a href="$value">$value</a>
				#else
					$value
				#end				
			#end
			</td>
		</tr>
	#end
</table>
</fieldset>

<fieldset>
<legend>Exported Services</legend>
<table>
	#set($services = $bundle.getRegisteredServices())
	<tr>
		<th>Servicd ID</th>
		<th>Object Classes</th>
		<th>Properties</th>
	</tr>
	#foreach($service in $services)
		<tr>
			<td valign="top">$service.getProperty("service.id")</td>
			<td valign="top">
				#foreach($serviceClass in $service.getProperty("objectClass"))
					$serviceClass<br />
				#end
			</td>
			<td valign="top">
				#foreach($propName in $service.getPropertyKeys())
					#if($propName != "service.id" && $propName != "objectClass")
						$propName=$service.getProperty($propName)<br />
					#end
				#end
			</td>
		</tr>
	#end	
</table>
</fieldset>

<fieldset>
<legend>Imported Services</legend>
<table>
	#set($services = $bundle.getServicesInUse())
	<tr>
		<th>Bundle ID</th>
		<th>Servicd ID</th>
		<th>Object Classes</th>
		<th>Properties</th>
	</tr>	
	#foreach($service in $services)
		<tr>
			<td valign="top"><a href="?bundleID=$service.Bundle.BundleId&details=">$service.Bundle.BundleId</a></td>
			<td valign="top">$service.getProperty("service.id")</td>
			<td valign="top">
				#foreach($serviceClass in $service.getProperty("objectClass"))
					$serviceClass<br />
				#end
			</td>
			<td valign="top">
				#foreach($propName in $service.getPropertyKeys())
					#if($propName != "service.id" && $propName != "objectClass")
						$propName=$service.getProperty($propName)<br />
					#end
				#end
			</td>			
		</tr>
	#end	
</table>
</fieldset>

#else
<h1>Bundle Controlpage</h1>
<table>
	<tr>
		<th>ID</th>
		<th>Name</th>
		<th>State</th>
		<th>Start</th>
		<th>Stop</th>
		<th>Update</th>
	</tr>
	#if($bundles)
		#foreach($entry in $bundles.entrySet())
			<tr>
				<td><a href="?bundleID=$entry.key&details=">$entry.key</a></td>
				<td>$entry.value.symbolicName</td>
				<td>$states.get($entry.value.state)</td>
				<td align="center"><form>
						<input type="hidden" name="bundleID" value="$entry.key" />
						<input type="submit" name="start" value="Start" />
				</form></td>
				<td align="center"><form>
						<input type="hidden" name="bundleID" value="$entry.key" />
						<input type="submit" name="stop" value="Stop" />
				</form></td>
				<td align="center"><form>
						<input type="hidden" name="bundleID" value="$entry.key" />
						<input type="submit" name="update" value="Update" />
				</form></td>
			</tr>
		#end
	#end
</table>
#end